<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="A navigation-view template generated by MyEclipse Mobile Tools"/>

    <title>Stock Application</title>
	
    <link rel="stylesheet" href="./css/jquery.mobile-1.4.3.css"/>
    
    <script type="text/javascript" src="./js/jquery-2.1.1.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript" src="./js/jquery.mobile-1.4.3.js"></script>
    
    <script type="text/javascript" src="cordova.js"></script>
    
    <script type="text/javascript" >
    
    document.addEventListener("deviceready", onDeviceReady, false);
             
            var db;
             
            function onDeviceReady() {
                db = window.openDatabase("Database", "1.0", "Cordova Demo", 2*1024*1024);
                db.transaction(createDB, errorCB, successCB);
     
            }
         
            function createDB(tx) {
                //tx.executeSql('DROP TABLE IF EXISTS DEMO');
                tx.executeSql('CREATE TABLE IF NOT EXISTS DEMO (title, image, description)');
                tx.executeSql('CREATE TABLE IF NOT EXISTS User (username, password, createddate)');
             
            }
         
            function errorCB(err) {
                alert("Error processing SQL: "+err.code);
            }
         
            function successCB() {
               //alert("YEAH!!!!");
            }
            
    </script>
    
    <script type="text/javascript">
    
    function insertDB(tx) {
                var _title = $("[name='title']").val();
                var _image = $("[name='image']").val();
                var _description = $("[name='description']").val();
                var sql = 'INSERT INTO DEMO (title, image, description) VALUES (?,?,?)';
                tx.executeSql(sql, [_title,_image,_description], sucessQueryDB, errorCB);
 
            }
            
               
            function sucessQueryDB(tx) {     
                tx.executeSql('SELECT * FROM DEMO', [], renderList, errorCB);
            }
         
            function renderList(tx,results) {
                var htmlstring = '';
                 
                var len = results.rows.length;
               
                for (var i=0; i<len; i++){
                    htmlstring += '<li>' + results.rows.item(i).title + ' <img src="'+ results.rows.item(i).image +'" ></li>';
                     
                }
                 
                $('#resultList').html(htmlstring);
                $('#resultList').listview('refresh');
                 
                 
            }
 
            function submitForm() {
                db.transaction(insertDB, errorCB);
                $.mobile.changePage( "#page3", { reverse: false, transition: "slide" } );
                return false;
            }
 
    </script>
    
    
    <script type="text/javascript" >
    
            
 
    function getUsers(tx) {
               tx.executeSql('SELECT * FROM User', [], renderUserList, errorCB);
 
            }
 
 function Submitform(){
    
    var _username = $('[name="txtUserName"]').val();
    var _password = $('[name="txtPassword"]').val();
 
    
    window.localStorage.setItem("UserName", _username);
    window.localStorage.setItem("password", _password);
    db.transaction(getUsers, errorCB);
     
    if( window.localStorage["IsAuth"] == true)
    {
     $.mobile.changePage("#page2",{reverse: false,transition: "slide"});
       
    $("#lblVal").html( window.localStorage["UserName"] + "  " +  window.localStorage["password"] );
    $("#AuthError").html("");
    }else{
    
     $("#AuthError").html("<strong>Error :</strong> user name or password not correct" );
    }
   
    
    
    return false;
    
    }
    
    
    
    function renderUserList(tx,results) {
    
                var htmlstring = '';
                var len = results.rows.length;
                  alert(len);
                for (var i=0; i<len; i++){
                  alert(results.rows.item(i).username);
                if(results.rows.item(i).username ==  window.localStorage["UserName"] && results.rows.item(i).password == window.localStorage["Password"]){
                
                	 window.localStorage["IsAuth"] = true;
                	 return true;
                }
                        
                }
                  window.localStorage["IsAuth"] = false;
              return false;
            }
    
    
 
            
            
         function   OpnePage(page){
         
         $.mobile.changePage( "#"+page, { reverse: false, transition: "slide" } );
         }
    </script>
    
    <script type="text/javascript">
    
       
    function insertUserDB(tx) {
    aler("inserting...");
                var _userNameR = $("[name='txtUserNameR']").val();
                var _PasswordR = $("[name='txtPasswordR']").val();
                var _createdDate = "1/1/2016";
                var sql = 'INSERT INTO User (username, password, createddate) VALUES (?,?,?)';
                tx.executeSql(sql, [_userNameR,_PasswordR,_createdDate], sucessQueryUserDB, errorCB);
 
            }
         
            function sucessQueryUserDB(tx) {
            aler("success...");     
               // window.location.href = "index.html";
            }
         
            
            function submitRegister() {
                db.transaction(insertUserDB, errorCB);
                $.mobile.changePage( "#page1", { reverse: false, transition: "slide" } );
                return false;
            }
            
    
    </script>
    
    
</head>

<body>
    <div data-role="page" id="page1">
        <div data-role="header" data-position="fixed" >
            <h1>Stock Control</h1>
        </div><!-- /header -->

        <div data-role="content" >
                        <h1>Log in</h1>
                        <div id="AuthError" style="color:maroon;">
                        
                        </div>       
                    <form style="margin-bottom: 10px;margin-top: 10px" method="POST" onSubmit="return Submitform()" data-ajax="false">
                    
                    	<label class="ui-hidden-accessible">User Name</label><input type="text"  name="txtUserName" id="txtUserName"  placeholder="UserName"/>
                        <label class="ui-hidden-accessible">Password</label><input type="password"  name="txtPassword" id="txtPassword" placeholder="Password"/>
                    
                    	<input type="submit" title="Submit" value="Submit"> 
                    	
                    	
                    	
                    </form>
                 
                    <a onclick="return OpnePage('register')">Register New User</a>
        </div><!-- /content -->

        <div data-role="footer" data-id="fool" data-position="fixed" >
            <div data-role="navbar">
                <ul>
                    <li><a href="index.html" class="ui-btn-active">Play List</a></li>
                    <li><a href="section1.html">Music</a></li>
                    <li><a href="section2.html">Artist</a></li>
                </ul>
            </div><!-- /navbar -->
        </div><!-- /footer -->
    </div><!-- /page -->
    
    <div data-role="page" id="page2">
            <div data-role="header" data-position="fixed" >
            <h1>Navigation Application</h1>
        </div><!-- /header -->
          <div data-role="content" >
        <div id="lblVal"></div>
        
        
          <form method="post" onsubmit="return submitForm()" id="myForm" data-ajax="false">
                    <lable for="title" class="ui-hidden-accessible">Title</lable><input type="text" name="title" placeholder="Title"><br>
                    <lable for="image" class="ui-hidden-accessible">Image</lable><input type="file" name="image" placeholder="image URI"><br>
                    <input type="text" name="description" placeholder="description">
                                 
                    <input type="submit" value="submit">
                </form>
 
    </div>
    
    <div data-role="footer" data-id="page2l" data-position="fixed" >
            <div data-role="navbar">
                <ul>
                    <li><a href="index.html" class="ui-btn-active">Play List</a></li>
                    <li><a href="section1.html">Music</a></li>
                    <li><a href="section2.html">Artist</a></li>
                </ul>
            </div><!-- /navbar -->
            
        </div><!-- /footer -->
   </div>
    
     <div data-role="page" id="page3">
            <div data-role="header" data-position="fixed" >
            <h1>Navigation Application</h1>
        </div><!-- /header -->
          <div data-role="content" >
     
  <ul data-role="listview" id="resultList">
                </ul>
         
 
    </div>
    
    <div data-role="footer" data-id="page3l" data-position="fixed" >
            <div data-role="navbar">
                <ul>
                    <li><a href="index.html" class="ui-btn-active">Play List</a></li>
                    <li><a href="section1.html">Music</a></li>
                    <li><a href="section2.html">Artist</a></li>
                </ul>
            </div><!-- /navbar -->
            
        </div><!-- /footer -->
   </div>
    
    
     <div data-role="page" id="register" data-position="fixed">
        <div data-role="header" >
            <h1>Navigation Application</h1>
        </div><!-- /header -->

        <div data-role="content" >
           <form method="post" onsubmit="return submitRegister()" data-ajax="false">
                    <lable for="title" class="ui-hidden-accessible">User Name</lable><input type="text" name="txtUserNameR" placeholder="User Name"><br>
                    <lable for="image" class="ui-hidden-accessible">Password</lable><input type="password" name="txtPasswordR" placeholder="Password"><br>
                                                    
                    <input type="submit" value="submit">
                </form>
           
        </div><!-- /content -->

        <div data-role="footer" data-id="fool" data-position="fixed" >
            <div data-role="navbar">
                <ul>
                    <li><a onclick="return OpnePage('page1')" >Login</a></li>
                 </ul>
            </div><!-- /navbar -->
        </div><!-- /footer -->
    </div><!-- /page -->
    
</body>
</html>